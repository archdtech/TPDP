// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Security Models for Authentication and Authorization

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // bcrypt hashed
  isActive  Boolean  @default(true)
  roleId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  role       Role       @relation(fields: [roleId], references: [id])
  sessions   Session[]
  auditLogs  AuditLog[]
  userProfile UserProfile?

  @@map("users")
}

model Role {
  id          String      @id @default(cuid())
  name        String      @unique
  description String?
  permissions Permission[]
  users       User[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("roles")
}

model Permission {
  id          String             @id @default(cuid())
  name        String             @unique
  description String?
  resource    String
  action      String
  conditions  Json?
  roles       Role[]
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  @@map("permissions")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  sessionToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model AuditLog {
  id          String   @id @default(cuid())
  userId      String?
  action      String
  resource    String?
  resourceId  String?
  metadata    Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  // Relationships
  user User? @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

model UserProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  firstName String?
  lastName  String?
  phone     String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

// Business Models for TPRM Platform

model Venture {
  id              String   @id @default(cuid())
  name            String
  description     String
  category        String
  stage           String   // "idea", "prototype", "mvp", "growth", "maturity"
  maturity        Int      // 1-100 maturity score
  priority        String   // "high", "medium", "low"
  status          String   // "active", "paused", "completed", "terminated"
  
  // Billion-Dollar Vision
  problemWorld    String?
  newWorld        String?
  valueUnlock     String?
  
  // Why You
  originStory     String?
  deepCapability  String?
  unfairAdvantage String?
  
  // Why Now
  unlockFactor    String?
  inevitability   String?
  urgencyTrigger  String?
  
  // Metrics
  marketSize      String?
  fundingNeed     String?
  timeline        String?
  
  // Technical
  repository      String?
  language        String?
  lastUpdated     DateTime @updatedAt
  createdAt       DateTime @default(now())
  
  @@map("ventures")
}

model Portfolio {
  id              String   @id @default(cuid())
  name            String
  description     String
  totalVentures   Int      @default(0)
  activeVentures  Int      @default(0)
  averageMaturity Float    @default(0)
  totalFunding    String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("portfolios")
}

model InvestorShare {
  id              String   @id @default(cuid())
  name            String
  email           String?
  company         String?
  password        String
  shareToken      String   @unique
  ventureIds      String   // JSON array of venture IDs to include
  isActive        Boolean  @default(true)
  expiresAt       DateTime?
  accessCount     Int      @default(0)
  lastAccessed    DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Configuration
  viewTemplate    String   @default("professional") // "professional", "detailed", "executive", "technical"
  includeMetrics  Boolean  @default(true)
  includeTimeline Boolean  @default(true)
  includeFinancial Boolean @default(true)
  allowDownload   Boolean  @default(false)
  customMessage   String?
  
  // Analytics
  viewDuration    Int      @default(0) // Total time spent viewing in seconds
  uniqueVisitors  Int      @default(0)
  lastVisitorIP   String?
  deviceInfo      String?  // JSON string with device/browser info
  
  @@map("investor_shares")
}